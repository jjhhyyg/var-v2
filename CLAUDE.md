# VAR熔池视频分析系统



## 系统模块介绍

系统分为后端、前端、核心处理模块三部分，三部分的通讯及整体系统工作流程见[该静态网页](./VAR熔池分析软件 - 系统图表.html)。

## 技术栈

后端采用Springboot3 + Spring JPA + PostgreSQL + Redis + Flyway 进行开发。

前端采用 Vue3 + Nuxt4 + Nuxt UI 4 进行开发。

核心处理模块采用 Flask + Pytorch 进行开发，对应conda环境为pytorch。

前后端项目环境已经配置好，pytorch conda环境下也安装好了flask和pytorch相关的包。

开发过程中用到的中间件：RabbitMQ、Redis、PostgreSQL、Java21环境、nginx代理均用Docker容器部署，不过开发过程中不使用Java21环境和nginx代理来部署前后端（便于开发），仅在部署阶段需将所有服务打包成一个完整的、便于一键部署的容器。

## 系统细节

### 具体检测内容

**动态参数**

熔池的闪烁频率（Hz）、面积（像素）、周长（像素），以时间为单位进行记录（便于画折线图）

**异常事件**

1. **熔池未到边：**即熔池边缘尚未达到结晶器边缘，处于过渡状态，出现在熔化初期
2. **电极形成粘连物：**此类为异常事件，即电极表面形成了黑色不规则状粘连物
3. **电极粘连物脱落：**此类为异常事件，即电极粘连物掉落，需注明**电极粘连物是掉落熔池中还是被结晶器捕获**
4. **锭冠脱落：**此类为异常事件，即**结晶器边缘锭冠掉落进入熔池**
5. **辉光：**此类为电弧异常事件，即电极环缝区域气体异常放电现象，**整个区域呈现高亮状态**
6. **边弧（侧弧）：**此类为电弧异常事件，即电弧持续出现在**电极边缘**，边缘**局部位置高亮**
7. **爬弧：**此类为电弧异常事件，即在**电极表面**出现**电弧迹线**，如闪电一样



对这些异常事件，我打算使用yolov11结合bytetrack来做多目标追踪，以确定粘连物生成、脱落的时间和脱落的位置，以及锭冠脱落及其他现象产生的时间段。

为此，我设计了如下两种类别定义方式：

第一种

```yaml
names:
  0: 熔池未到边
  1: 电极形成粘连物
  2: 电极粘连物脱落
  3: 锭冠脱落
  4: 辉光
  5: 边弧（侧弧）
  6: 爬弧
```

第二种

```yaml
names:
  0: 熔池未到边
  1: 粘连物
  2: 锭冠
  3: 辉光
  4: 边弧（侧弧）
  5: 爬弧
```

**已确定使用第二种方式**（检测物体而非事件），原因如下：
1. 符合ByteTrack多目标追踪的本质（追踪物体而非事件）
2. 可通过轨迹分析推断事件（首次出现=形成，消失=脱落）
3. 标注成本更低，类别数更少（6类 vs 7类）

最终类别定义：
```yaml
names:
  0: 熔池未到边
  1: 粘连物
  2: 锭冠
  3: 辉光
  4: 边弧（侧弧）
  5: 爬弧
```

事件推断逻辑：
- 粘连物首次检测到 → 记录"电极形成粘连物"事件
- 粘连物轨迹消失 → 记录"电极粘连物脱落"事件，根据消失位置判断落入熔池还是被结晶器捕获
- 锭冠从结晶器边缘运动至熔池 → 记录"锭冠脱落"事件



## 编码需求

### 后端

**一定一定**要用mcp去查看最新版的开发文档！结合你的知识库和最新版开发文档中的代码变动进行编码。

数据库更改**只能**用flyway迁移脚本来进行。

### 前端

**一定一定**要用mcp去查看最新版的开发文档！结合你的知识库和最新版开发文档中的代码变动进行编码。



### 核心处理模块

**一定一定**要用mcp去查看最新版的开发文档！结合你的知识库和最新版开发文档中的代码变动进行编码。

## 系统配置项

### 超时控制
- **超时比例**：视频时长与处理时长的比例，例如 `1:4` 表示30分钟视频最多处理120分钟
- **可配置比例**：支持 `2:5`、`1:8` 等自定义比例
- **超时行为**：超时后继续处理至任务结束，但标记为"已完成（超时）"状态

### 检测配置
- **置信度阈值**：边界框检测的置信度阈值，可配置为 `0.4`、`0.6` 等（默认 `0.5`）
- **IoU阈值**：NMS的IoU阈值（默认 `0.45`）
