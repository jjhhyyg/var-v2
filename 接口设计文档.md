# VARç†”æ± è§†é¢‘åˆ†æç³»ç»Ÿ - æ¥å£è®¾è®¡æ–‡æ¡£

## 1. æ¥å£æ¦‚è¿°

### 1.1 æœåŠ¡ç«¯å£
- **åç«¯æœåŠ¡**ï¼šhttp://localhost:8080
- **AIå¤„ç†æ¨¡å—**ï¼šhttp://localhost:5000ï¼ˆå†…éƒ¨è°ƒç”¨ï¼Œå‰ç«¯ä¸ç›´æ¥è®¿é—®ï¼‰
- **å‰ç«¯**ï¼šhttp://localhost:3000

### 1.2 é€šç”¨è§„èŒƒ
- **åè®®**ï¼šHTTP/1.1
- **æ•°æ®æ ¼å¼**ï¼šJSON
- **ç¼–ç **ï¼šUTF-8
- **å“åº”ç»“æ„**ï¼š
```json
{
  "code": 0,           // 0=æˆåŠŸ, é0=é”™è¯¯ç 
  "message": "success",
  "data": { ... },     // å“åº”æ•°æ®
  "timestamp": 1696147200000
}
```

### 1.3 é”™è¯¯ç å®šä¹‰
| é”™è¯¯ç  | è¯´æ˜ |
|--------|------|
| 0 | æˆåŠŸ |
| 400 | è¯·æ±‚å‚æ•°é”™è¯¯ |
| 404 | èµ„æºä¸å­˜åœ¨ |
| 500 | æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ |
| 1001 | è§†é¢‘æ ¼å¼ä¸æ”¯æŒ |
| 1002 | ä»»åŠ¡ä¸å­˜åœ¨ |
| 1003 | ä»»åŠ¡å¤„ç†å¤±è´¥ |

---

## 2. åç«¯APIæ¥å£ï¼ˆå‰ç«¯è°ƒç”¨ï¼‰

### 2.1 ä»»åŠ¡ç®¡ç†

#### 2.1.1 ä¸Šä¼ è§†é¢‘å¹¶åˆ›å»ºåˆ†æä»»åŠ¡
**æ¥å£**ï¼š`POST /api/tasks/upload`

**è¯·æ±‚å¤´**ï¼š
```
Content-Type: multipart/form-data
```

**è¯·æ±‚å‚æ•°**ï¼š
| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| video | File | æ˜¯ | è§†é¢‘æ–‡ä»¶ï¼ˆæ”¯æŒmp4/avi/movï¼Œæœ€å¤§2GBï¼‰ |
| name | String | å¦ | ä»»åŠ¡åç§°ï¼ˆé»˜è®¤ä½¿ç”¨æ–‡ä»¶åï¼‰ |
| description | String | å¦ | ä»»åŠ¡æè¿° |
| timeoutRatio | String | å¦ | è¶…æ—¶æ¯”ä¾‹ï¼ˆå¦‚"1:4"ï¼Œé»˜è®¤"1:4"ï¼‰ |
| confidenceThreshold | Float | å¦ | ç½®ä¿¡åº¦é˜ˆå€¼ï¼ˆ0.1~0.9ï¼Œé»˜è®¤0.5ï¼‰ |
| iouThreshold | Float | å¦ | IoUé˜ˆå€¼ï¼ˆ0.3~0.7ï¼Œé»˜è®¤0.45ï¼‰ |

**ä¸Šä¼ é™åˆ¶**ï¼š
- æ–‡ä»¶å¤§å°ï¼šæœ€å¤§ 2GB (2147483648 bytes)
- æ”¯æŒæ ¼å¼ï¼šmp4, avi, mov, mkv
- æ–‡ä»¶æ ¼å¼æ ¡éªŒï¼šé€šè¿‡MIMEç±»å‹å’Œé­”æ•°éªŒè¯
- è¶…å‡ºé™åˆ¶è¿”å›é”™è¯¯ç ï¼š1001ï¼ˆè§†é¢‘æ ¼å¼ä¸æ”¯æŒï¼‰

**å“åº”ç¤ºä¾‹**ï¼š

```json
{
  "code": 0,
  "message": "ä»»åŠ¡åˆ›å»ºæˆåŠŸ",
  "data": {
    "taskId": "uuid-xxx-xxx",
    "name": "å®éªŒè§†é¢‘_20250101.mp4",
    "status": "PENDING",
    "videoDuration": 1800,  // è§†é¢‘æ—¶é•¿ï¼ˆç§’ï¼‰
    "timeoutThreshold": 7200,  // è¶…æ—¶é˜ˆå€¼ï¼ˆç§’ï¼‰
    "config": {
      "timeoutRatio": "1:4",
      "confidenceThreshold": 0.5,
      "iouThreshold": 0.45
    },
    "createdAt": "2025-10-01T10:30:00Z"
  }
}
```

---

#### 2.1.2 æŸ¥è¯¢ä»»åŠ¡åˆ—è¡¨
**æ¥å£**ï¼š`GET /api/tasks`

**è¯·æ±‚å‚æ•°**ï¼š
| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| page | Integer | å¦ | é¡µç ï¼ˆä»0å¼€å§‹ï¼Œé»˜è®¤0ï¼‰ |
| size | Integer | å¦ | æ¯é¡µæ•°é‡ï¼ˆé»˜è®¤20ï¼‰ |
| status | String | å¦ | çŠ¶æ€ç­›é€‰ï¼ˆPENDING/PREPROCESSING/ANALYZING/COMPLETED/COMPLETED_TIMEOUT/FAILEDï¼‰ |

**å“åº”ç¤ºä¾‹**ï¼š
```json
{
  "code": 0,
  "data": {
    "content": [
      {
        "taskId": "uuid-xxx-xxx",
        "name": "å®éªŒè§†é¢‘_20250101.mp4",
        "status": "COMPLETED",
        "isTimeout": false,
        "progress": 1.0,
        "videoDuration": 1800,
        "preprocessingDuration": 15,  // é¢„å¤„ç†è€—æ—¶ï¼ˆç§’ï¼‰
        "analyzingDuration": 2715,    // åˆ†æè€—æ—¶ï¼ˆç§’ï¼‰
        "totalDuration": 2730,        // æ€»è€—æ—¶ï¼ˆç§’ï¼‰
        "timeoutThreshold": 7200,     // è¶…æ—¶é˜ˆå€¼ï¼ˆç§’ï¼‰
        "createdAt": "2025-10-01T10:30:00Z",
        "startedAt": "2025-10-01T10:30:05Z",
        "preprocessingCompletedAt": "2025-10-01T10:30:20Z",
        "completedAt": "2025-10-01T11:15:30Z"
      },
      {
        "taskId": "uuid-yyy-yyy",
        "name": "å®éªŒè§†é¢‘_20250102.mp4",
        "status": "ANALYZING",
        "isTimeout": false,
        "progress": 0.35,
        "phase": "analyzing",
        "videoDuration": 3600,
        "preprocessingDuration": 20,
        "analyzingDuration": 3200,  // å½“å‰å·²åˆ†ææ—¶é•¿
        "timeoutThreshold": 14400,
        "createdAt": "2025-10-01T12:00:00Z",
        "startedAt": "2025-10-01T12:00:05Z",
        "preprocessingCompletedAt": "2025-10-01T12:00:25Z"
      },
      {
        "taskId": "uuid-zzz-zzz",
        "name": "å®éªŒè§†é¢‘_20250103.mp4",
        "status": "COMPLETED_TIMEOUT",
        "isTimeout": true,
        "progress": 1.0,
        "videoDuration": 3600,
        "preprocessingDuration": 18,
        "analyzingDuration": 17982,  // è¶…è¿‡äº†é˜ˆå€¼
        "totalDuration": 18000,
        "timeoutThreshold": 14400,
        "createdAt": "2025-10-01T14:00:00Z",
        "completedAt": "2025-10-01T19:00:00Z"
      }
    ],
    "totalElements": 45,
    "totalPages": 3,
    "number": 0,
    "size": 20
  }
}
```

---

#### 2.1.3 æŸ¥è¯¢ä»»åŠ¡è¯¦æƒ…
**æ¥å£**ï¼š`GET /api/tasks/{taskId}`

**è·¯å¾„å‚æ•°**ï¼š
| å‚æ•°å | ç±»å‹ | è¯´æ˜ |
|--------|------|------|
| taskId | String | ä»»åŠ¡ID |

**å“åº”ç¤ºä¾‹**ï¼š
```json
{
  "code": 0,
  "data": {
    "taskId": "uuid-xxx-xxx",
    "name": "å®éªŒè§†é¢‘_20250101.mp4",
    "status": "COMPLETED",
    "isTimeout": false,
    "progress": 1.0,
    "phase": "completed",  // preprocessing/analyzing/completed
    "videoPath": "/uploads/2025/10/01/video_xxx.mp4",
    "totalFrames": 12000,
    "processedFrames": 12000,
    "fps": 30,
    "videoDuration": 400,  // è§†é¢‘æ—¶é•¿ï¼ˆç§’ï¼‰
    "preprocessingDuration": 8,     // é¢„å¤„ç†è€—æ—¶ï¼ˆç§’ï¼‰
    "analyzingDuration": 2722,      // åˆ†æè€—æ—¶ï¼ˆç§’ï¼‰
    "totalDuration": 2730,          // æ€»è€—æ—¶ï¼ˆç§’ï¼‰
    "timeoutThreshold": 1600,       // è¶…æ—¶é˜ˆå€¼ï¼ˆç§’ï¼‰
    "config": {
      "timeoutRatio": "1:4",
      "confidenceThreshold": 0.5,
      "iouThreshold": 0.45,
      "modelVersion": "yolov11n"
    },
    "createdAt": "2025-10-01T10:30:00Z",
    "startedAt": "2025-10-01T10:30:15Z",
    "preprocessingCompletedAt": "2025-10-01T10:30:23Z",
    "completedAt": "2025-10-01T11:15:30Z"
  }
}
```

---

#### 2.1.4 è·å–ä»»åŠ¡å®æ—¶è¿›åº¦
**æ¥å£**ï¼š`GET /api/tasks/{taskId}/progress`

**é¢„å¤„ç†é˜¶æ®µç¤ºä¾‹**ï¼š
```json
{
  "code": 0,
  "data": {
    "status": "PREPROCESSING",
    "phase": "è§†é¢‘é¢„å¤„ç†ä¸­",
    "progress": 0.0,
    "message": "æ­£åœ¨è§£æè§†é¢‘å…ƒæ•°æ®...",
    "elapsedTime": 5,
    "timeoutThreshold": 7200
  }
}
```

**åˆ†æé˜¶æ®µç¤ºä¾‹**ï¼š
```json
{
  "code": 0,
  "data": {
    "status": "ANALYZING",
    "phase": "è§†é¢‘åˆ†æä¸­",
    "progress": 0.45,
    "currentFrame": 5400,
    "totalFrames": 12000,
    "preprocessingDuration": 10,      // é¢„å¤„ç†è€—æ—¶ï¼ˆç§’ï¼‰
    "analyzingElapsedTime": 1490,     // åˆ†æå·²ç”¨æ—¶é—´ï¼ˆç§’ï¼‰
    "estimatedTimeRemaining": 1800,   // é¢„è®¡å‰©ä½™æ—¶é—´ï¼ˆç§’ï¼‰
    "timeoutThreshold": 7200,         // è¶…æ—¶é˜ˆå€¼ï¼ˆç§’ï¼‰
    "isTimeout": false,               // æ˜¯å¦å·²è¶…æ—¶
    "timeoutWarning": false           // æ˜¯å¦æ¥è¿‘è¶…æ—¶ï¼ˆåˆ†ææ—¶é—´ > 80%é˜ˆå€¼ï¼‰
  }
}
```

**è¶…æ—¶é¢„è­¦ç¤ºä¾‹**ï¼š
```json
{
  "code": 0,
  "data": {
    "status": "ANALYZING",
    "phase": "è§†é¢‘åˆ†æä¸­",
    "progress": 0.65,
    "currentFrame": 7800,
    "totalFrames": 12000,
    "preprocessingDuration": 10,
    "analyzingElapsedTime": 5990,     // åˆ†æå·²ç”¨5990ç§’
    "estimatedTimeRemaining": 3230,
    "timeoutThreshold": 7200,         // é˜ˆå€¼7200ç§’
    "isTimeout": false,
    "timeoutWarning": true            // å·²æ¥è¿‘è¶…æ—¶ï¼ˆ83%ï¼‰
  }
}
```

**å·²è¶…æ—¶ç¤ºä¾‹**ï¼š
```json
{
  "code": 0,
  "data": {
    "status": "ANALYZING",
    "phase": "è§†é¢‘åˆ†æä¸­ï¼ˆå·²è¶…æ—¶ï¼‰",
    "progress": 0.75,
    "currentFrame": 9000,
    "totalFrames": 12000,
    "preprocessingDuration": 10,
    "analyzingElapsedTime": 7490,     // å·²è¶…è¿‡é˜ˆå€¼
    "estimatedTimeRemaining": 2500,
    "timeoutThreshold": 7200,
    "isTimeout": true,                // å·²è¶…æ—¶ï¼Œä½†ç»§ç»­å¤„ç†
    "timeoutWarning": true
  }
}
```

---

#### 2.1.5 åˆ é™¤ä»»åŠ¡
**æ¥å£**ï¼š`DELETE /api/tasks/{taskId}`

**å“åº”ç¤ºä¾‹**ï¼š
```json
{
  "code": 0,
  "message": "ä»»åŠ¡å·²åˆ é™¤"
}
```

---

### 2.2 åˆ†æç»“æœæŸ¥è¯¢

#### 2.2.1 è·å–åŠ¨æ€å‚æ•°æ•°æ®
**æ¥å£**ï¼š`GET /api/tasks/{taskId}/metrics`

**è¯·æ±‚å‚æ•°**ï¼š
| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| startFrame | Integer | å¦ | èµ·å§‹å¸§å· |
| endFrame | Integer | å¦ | ç»“æŸå¸§å· |
| interval | Integer | å¦ | æ•°æ®é—´éš”ï¼ˆé»˜è®¤1ï¼Œå³æ¯å¸§ï¼‰ |

**å“åº”ç¤ºä¾‹**ï¼š
```json
{
  "code": 0,
  "data": {
    "taskId": "uuid-xxx-xxx",
    "metrics": [
      {
        "frameNumber": 100,
        "timestamp": 3.33,  // æ—¶é—´ï¼ˆç§’ï¼‰
        "flickerFrequency": 15.2,  // é—ªçƒé¢‘ç‡ï¼ˆHzï¼‰
        "poolArea": 45800,  // ç†”æ± é¢ç§¯ï¼ˆåƒç´ ï¼‰
        "poolPerimeter": 1250  // ç†”æ± å‘¨é•¿ï¼ˆåƒç´ ï¼‰
      },
      {
        "frameNumber": 101,
        "timestamp": 3.37,
        "flickerFrequency": 15.5,
        "poolArea": 45950,
        "poolPerimeter": 1255
      }
      // ... æ›´å¤šæ•°æ®ç‚¹
    ]
  }
}
```

---

#### 2.2.2 è·å–å¼‚å¸¸äº‹ä»¶åˆ—è¡¨
**æ¥å£**ï¼š`GET /api/tasks/{taskId}/events`

**è¯·æ±‚å‚æ•°**ï¼š
| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| eventType | String | å¦ | äº‹ä»¶ç±»å‹ç­›é€‰ |

**äº‹ä»¶ç±»å‹æšä¸¾**ï¼š
- `POOL_NOT_EDGE`ï¼šç†”æ± æœªåˆ°è¾¹
- `ADHESION_FORMED`ï¼šç”µæå½¢æˆç²˜è¿ç‰©
- `ADHESION_DROPPED`ï¼šç²˜è¿ç‰©è„±è½
- `CROWN_DROPPED`ï¼šé”­å† è„±è½
- `GLOW`ï¼šè¾‰å…‰
- `SIDE_ARC`ï¼šè¾¹å¼§ï¼ˆä¾§å¼§ï¼‰
- `CLIMBING_ARC`ï¼šçˆ¬å¼§

**å“åº”ç¤ºä¾‹**ï¼š
```json
{
  "code": 0,
  "data": {
    "events": [
      {
        "eventId": "evt-001",
        "eventType": "ADHESION_FORMED",
        "eventName": "ç”µæå½¢æˆç²˜è¿ç‰©",
        "startFrame": 1500,
        "endFrame": 1500,  // ç¬æ—¶äº‹ä»¶ï¼Œèµ·å§‹=ç»“æŸ
        "startTime": 50.0,  // æ—¶é—´ï¼ˆç§’ï¼‰
        "endTime": 50.0,
        "objectId": "track_12",  // ByteTrackè¿½è¸ªID
        "metadata": {
          "position": {"x": 320, "y": 180},
          "boundingBox": {"x": 300, "y": 160, "w": 40, "h": 40}
        }
      },
      {
        "eventId": "evt-002",
        "eventType": "ADHESION_DROPPED",
        "eventName": "ç²˜è¿ç‰©è„±è½",
        "startFrame": 3200,
        "endFrame": 3200,
        "startTime": 106.67,
        "endTime": 106.67,
        "objectId": "track_12",
        "metadata": {
          "dropLocation": "POOL",  // POOL=è½å…¥ç†”æ± , CRUCIBLE=è¢«ç»“æ™¶å™¨æ•è·
          "finalPosition": {"x": 400, "y": 350}
        }
      },
      {
        "eventId": "evt-003",
        "eventType": "GLOW",
        "eventName": "è¾‰å…‰",
        "startFrame": 5000,
        "endFrame": 5150,  // æŒç»­äº‹ä»¶
        "startTime": 166.67,
        "endTime": 171.67,
        "metadata": {
          "region": "ELECTRODE_GAP"
        }
      }
    ]
  }
}
```

---

#### 2.2.3 è·å–è¿½è¸ªç‰©ä½“è½¨è¿¹
**æ¥å£**ï¼š`GET /api/tasks/{taskId}/tracks`

**è¯·æ±‚å‚æ•°**ï¼š
| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| category | String | å¦ | ç‰©ä½“ç±»åˆ«ï¼ˆADHESION/CROWNï¼‰ |

**å“åº”ç¤ºä¾‹**ï¼š
```json
{
  "code": 0,
  "data": {
    "tracks": [
      {
        "objectId": "track_12",
        "category": "ADHESION",
        "categoryName": "ç²˜è¿ç‰©",
        "firstFrame": 1500,
        "lastFrame": 3200,
        "lifespan": 56.67,  // å­˜åœ¨æ—¶é•¿ï¼ˆç§’ï¼‰
        "trajectory": [
          {
            "frame": 1500,
            "time": 50.0,
            "position": {"x": 320, "y": 180},
            "boundingBox": {"x": 300, "y": 160, "w": 40, "h": 40},
            "confidence": 0.95
          },
          {
            "frame": 1501,
            "time": 50.03,
            "position": {"x": 321, "y": 181},
            "boundingBox": {"x": 301, "y": 161, "w": 40, "h": 40},
            "confidence": 0.94
          }
          // ... æ›´å¤šè½¨è¿¹ç‚¹
        ]
      }
    ]
  }
}
```

---

### 2.3 è§†é¢‘è®¿é—®

#### 2.3.1 è·å–åŸå§‹è§†é¢‘
**æ¥å£**ï¼š`GET /api/tasks/{taskId}/video/{startTime}`

è¯·æ±‚å‚æ•°ï¼šstartTimeï¼Œç±»å‹ä¸ºIntegerï¼Œè¡¨ç¤ºä»ç¬¬å‡ ç§’å¼€å§‹æ’­æ”¾ï¼Œä¸ºç©ºæ—¶ä»å¤´æ’­æ”¾

**å“åº”**ï¼šè§†é¢‘æ–‡ä»¶æµï¼ˆContent-Type: video/mp4ï¼‰

---

#### 2.3.2 è·å–å¸¦æ ‡æ³¨çš„è§†é¢‘ï¼ˆå¯é€‰åŠŸèƒ½ï¼‰
**æ¥å£**ï¼š`GET /api/tasks/{taskId}/annotated-video`

**è¯·æ±‚å‚æ•°**ï¼š
| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| showBoundingBox | Boolean | å¦ | æ˜¾ç¤ºæ£€æµ‹æ¡†ï¼ˆé»˜è®¤trueï¼‰ |
| showTrackId | Boolean | å¦ | æ˜¾ç¤ºè¿½è¸ªIDï¼ˆé»˜è®¤trueï¼‰ |
| showEvents | Boolean | å¦ | æ˜¾ç¤ºäº‹ä»¶æ ‡è®°ï¼ˆé»˜è®¤trueï¼‰ |

**å“åº”**ï¼šè§†é¢‘æ–‡ä»¶æµ

---

## 3. åç«¯å†…éƒ¨æ¥å£ï¼ˆAIæ¨¡å—è°ƒç”¨ï¼‰

### 3.1 è¿›åº¦å›è°ƒ
**æ¥å£**ï¼š`POST /api/internal/tasks/{taskId}/progress`

**è¯·æ±‚å¤´**ï¼š
```
Content-Type: application/json
Authorization: Bearer {INTERNAL_TOKEN}  // å†…éƒ¨æœåŠ¡è®¤è¯
```

**è¯·æ±‚ä½“**ï¼š

```json
{
  "status": "ANALYZING",  // PREPROCESSING æˆ– ANALYZING
  "phase": "è§†é¢‘åˆ†æä¸­",   // è§†é¢‘é¢„å¤„ç†ä¸­ æˆ– è§†é¢‘åˆ†æä¸­
  "currentFrame": 5400,
  "totalFrames": 12000,
  "progress": 0.45,
  "preprocessingDuration": 10,   // é¢„å¤„ç†è€—æ—¶ï¼ˆç§’ï¼Œé¢„å¤„ç†å®Œæˆåæ‰æœ‰ï¼‰
  "analyzingElapsedTime": 1490,  // åˆ†æå·²ç”¨æ—¶é—´ï¼ˆç§’ï¼Œåˆ†æé˜¶æ®µæ‰æœ‰ï¼‰
  "isTimeout": false  // æ˜¯å¦å·²è¶…æ—¶
}
```

**é¢„å¤„ç†é˜¶æ®µè¯·æ±‚ç¤ºä¾‹**ï¼š
```json
{
  "status": "PREPROCESSING",
  "phase": "è§†é¢‘é¢„å¤„ç†ä¸­",
  "progress": 0.0,
  "message": "æ­£åœ¨è¯»å–è§†é¢‘å…ƒæ•°æ®..."
}
```

**å“åº”ç¤ºä¾‹**ï¼š

```json
{
  "code": 0,
  "message": "è¿›åº¦å·²æ›´æ–°"
}
```

---

### 3.2 ç»“æœæäº¤
**æ¥å£**ï¼š`POST /api/internal/tasks/{taskId}/result`

**è¯·æ±‚å¤´**ï¼š
```
Content-Type: application/json
Authorization: Bearer {INTERNAL_TOKEN}
```

**è¯·æ±‚ä½“**ï¼š

```json
{
  "status": "COMPLETED",  // æˆ– COMPLETED_TIMEOUT æˆ– FAILED
  "isTimeout": false,  // æ˜¯å¦è¶…æ—¶å®Œæˆ
  "preprocessingDuration": 10,   // é¢„å¤„ç†è€—æ—¶ï¼ˆç§’ï¼‰
  "analyzingDuration": 2720,     // åˆ†æè€—æ—¶ï¼ˆç§’ï¼‰
  "totalDuration": 2730,         // æ€»è€—æ—¶ï¼ˆç§’ï¼‰
  "metrics": [
    {
      "frameNumber": 100,
      "timestamp": 3.33,
      "flickerFrequency": 15.2,
      "poolArea": 45800,
      "poolPerimeter": 1250
    }
    // ... æ‰€æœ‰å¸§çš„æ•°æ®
  ],
  "events": [
    {
      "eventType": "ADHESION_FORMED",
      "startFrame": 1500,
      "endFrame": 1500,
      "objectId": "track_12",
      "metadata": { ... }
    }
    // ... æ‰€æœ‰äº‹ä»¶
  ],
  "tracks": [
    {
      "objectId": "track_12",
      "category": "ADHESION",
      "firstFrame": 1500,
      "lastFrame": 3200,
      "trajectory": [ ... ]
    }
    // ... æ‰€æœ‰è¿½è¸ªè½¨è¿¹
  ],
  "errorMessage": null  // å¤±è´¥æ—¶å¡«å†™é”™è¯¯ä¿¡æ¯
}
```

**å“åº”ç¤ºä¾‹**ï¼š
```json
{
  "code": 0,
  "message": "ç»“æœå·²ä¿å­˜"
}
```

---

## 4. AIå¤„ç†æ¨¡å—æ¥å£ï¼ˆå†…éƒ¨HTTP APIï¼‰

### 4.1 å¥åº·æ£€æŸ¥
**æ¥å£**ï¼š`GET /health`

**å“åº”ç¤ºä¾‹**ï¼š
```json
{
  "status": "healthy",
  "model_loaded": true,
  "gpu_available": true,
  "version": "1.0.0"
}
```

---

### 4.2 ç›´æ¥åˆ†ææ¥å£ï¼ˆå¤‡ç”¨æ–¹æ¡ˆï¼Œå¯ä¸é€šè¿‡MQï¼‰
**æ¥å£**ï¼š`POST /api/analyze`

**è¯·æ±‚ä½“**ï¼š
```json
{
  "taskId": "uuid-xxx-xxx",
  "videoPath": "/path/to/video.mp4",
  "videoDuration": 1800,
  "timeoutThreshold": 7200,
  "callbackUrl": "http://backend:8080/api/internal/tasks/{taskId}/result",
  "config": {
    "confidenceThreshold": 0.5,
    "iouThreshold": 0.45,
    "timeoutRatio": "1:4"
  }
}
```

**å“åº”ç¤ºä¾‹**ï¼š
```json
{
  "status": "accepted",
  "taskId": "uuid-xxx-xxx",
  "message": "ä»»åŠ¡å·²æ¥å—ï¼Œå¼€å§‹å¤„ç†"
}
```

---

## 5. RabbitMQæ¶ˆæ¯é˜Ÿåˆ—è®¾è®¡

### 5.1 ä»»åŠ¡é˜Ÿåˆ—
**é˜Ÿåˆ—å**ï¼š`video_analysis_queue`

**æ¶ˆæ¯æ ¼å¼**ï¼š
```json
{
  "taskId": "uuid-xxx-xxx",
  "videoPath": "/uploads/2025/10/01/video_xxx.mp4",
  "videoDuration": 1800,  // è§†é¢‘æ—¶é•¿ï¼ˆç§’ï¼‰
  "timeoutThreshold": 7200,  // è¶…æ—¶é˜ˆå€¼ï¼ˆç§’ï¼‰
  "callbackUrl": "http://backend:8080/api/internal/tasks/uuid-xxx-xxx/result",
  "config": {
    "model": "yolov11n",  // æ¨¡å‹ç‰ˆæœ¬
    "confidenceThreshold": 0.5,    // ç½®ä¿¡åº¦é˜ˆå€¼
    "iouThreshold": 0.45,          // NMSçš„IoUé˜ˆå€¼
    "timeoutRatio": "1:4"          // è¶…æ—¶æ¯”ä¾‹
  }
}
```

**æ¶ˆæ¯å±æ€§**ï¼š
- **delivery_mode**: 2ï¼ˆæŒä¹…åŒ–ï¼‰
- **priority**: 5ï¼ˆä¼˜å…ˆçº§ï¼š0-10ï¼‰

---

### 5.2 è¿›åº¦é€šçŸ¥é˜Ÿåˆ—ï¼ˆå¿…é¡»ï¼‰
**é˜Ÿåˆ—å**ï¼š`analysis_progress_queue`

**æ¶ˆæ¯æ ¼å¼**ï¼š
```json
{
  "taskId": "uuid-xxx-xxx",
  "progress": 0.45,
  "currentFrame": 5400,
  "totalFrames": 12000
}
```

---

## 6. Redisç¼“å­˜é”®è®¾è®¡

| Key | ç±»å‹ | TTL | è¯´æ˜ | ç¤ºä¾‹å€¼ |
|-----|------|-----|------|--------|
| `task:{taskId}:status` | String | 1h | ä»»åŠ¡çŠ¶æ€ | "PROCESSING" |
| `task:{taskId}:progress` | Hash | 1h | å®æ—¶è¿›åº¦ | {"current": 5400, "total": 12000, "elapsedTime": 1500} |
| `task:{taskId}:timeout` | Hash | åŠ¨æ€ | è¶…æ—¶ä¿¡æ¯ | {"threshold": 7200, "isTimeout": false, "warning": false} |
| `task:{taskId}:result` | String(JSON) | 24h | åˆ†æç»“æœç¼“å­˜ | {...} |
| `config:timeout_ratio` | String | - | å…¨å±€é»˜è®¤è¶…æ—¶æ¯”ä¾‹ | "1:4" |
| `config:confidence_threshold` | String | - | å…¨å±€é»˜è®¤ç½®ä¿¡åº¦é˜ˆå€¼ | "0.5" |

---

## 7. WebSocketæ¥å£ï¼ˆå¿…é¡»ï¼Œå®æ—¶æ¨é€ï¼‰

### 7.1 è¿æ¥ç«¯ç‚¹
**ç«¯ç‚¹**ï¼š`ws://localhost:8080/ws/tasks/{taskId}`

### 7.2 æ¶ˆæ¯æ ¼å¼

**çŠ¶æ€å˜æ›´æ¨é€**ï¼š
```json
{
  "type": "STATUS_CHANGE",
  "data": {
    "status": "ANALYZING",
    "previousStatus": "PREPROCESSING",
    "message": "é¢„å¤„ç†å®Œæˆï¼Œå¼€å§‹åˆ†æ..."
  }
}
```

**è¿›åº¦æ¨é€**ï¼š
```json
{
  "type": "PROGRESS",
  "data": {
    "status": "ANALYZING",
    "phase": "analyzing",
    "progress": 0.45,
    "currentFrame": 5400,
    "totalFrames": 12000,
    "isTimeout": false
  }
}
```

**ä»»åŠ¡å®Œæˆé€šçŸ¥**ï¼š
```json
{
  "type": "COMPLETED",
  "data": {
    "taskId": "uuid-xxx-xxx",
    "status": "COMPLETED"
  }
}
```

---

## 8. æ¥å£è°ƒç”¨ç¤ºä¾‹

### 8.1 å‰ç«¯å®Œæ•´æµç¨‹ï¼ˆVue3 + Axiosï¼‰

```javascript
// 1. ä¸Šä¼ è§†é¢‘
const uploadVideo = async (file) => {
  const formData = new FormData();
  formData.append('video', file);
  formData.append('name', file.name);

  const { data } = await axios.post('/api/tasks/upload', formData, {
    headers: { 'Content-Type': 'multipart/form-data' }
  });

  return data.data.taskId;
};

// 2. è½®è¯¢ä»»åŠ¡è¿›åº¦
const pollProgress = async (taskId) => {
  const interval = setInterval(async () => {
    const { data } = await axios.get(`/api/tasks/${taskId}/progress`);
    const { status, phase, progress, isTimeout, timeoutWarning } = data.data;

    // æ›´æ–°è¿›åº¦æ¡å’ŒçŠ¶æ€æ˜¾ç¤º
    if (status === 'PREPROCESSING') {
      updateStatus('é¢„å¤„ç†ä¸­ï¼š' + (data.data.message || 'æ­£åœ¨å‡†å¤‡...'));
    } else if (status === 'ANALYZING') {
      updateStatus(`åˆ†æä¸­ï¼š${(progress * 100).toFixed(1)}%`);
      updateProgressBar(progress);

      // è¶…æ—¶é¢„è­¦
      if (timeoutWarning && !isTimeout) {
        showWarning('å¤„ç†æ¥è¿‘è¶…æ—¶ï¼Œè¯·è€å¿ƒç­‰å¾…...');
      } else if (isTimeout) {
        showWarning('å¤„ç†å·²è¶…æ—¶ï¼Œä½†ä»åœ¨ç»§ç»­...');
      }
    } else if (status === 'COMPLETED' || status === 'COMPLETED_TIMEOUT') {
      clearInterval(interval);
      if (status === 'COMPLETED_TIMEOUT') {
        showWarning('ä»»åŠ¡å·²å®Œæˆï¼Œä½†å¤„ç†æ—¶é—´è¶…è¿‡é¢„æœŸ');
      }
      loadResults(taskId);
    } else if (status === 'FAILED') {
      clearInterval(interval);
      console.error('ä»»åŠ¡å¤±è´¥');
    }
  }, 2000);
};

// 3. åŠ è½½åˆ†æç»“æœ
const loadResults = async (taskId) => {
  const [metrics, events] = await Promise.all([
    axios.get(`/api/tasks/${taskId}/metrics`),
    axios.get(`/api/tasks/${taskId}/events`)
  ]);

  renderCharts(metrics.data.data);
  renderEventTimeline(events.data.data);
};
```

---

### 8.2 AIæ¨¡å—å¤„ç†æµç¨‹ï¼ˆFlask + requestsï¼‰

```python
import requests
from analysis_engine import analyze_video

import time

def process_task(message):
    task_id = message['taskId']
    video_path = message['videoPath']
    callback_url = message['callbackUrl']
    timeout_threshold = message['timeoutThreshold']

    preprocessing_start = time.time()

    try:
        # 1. é¢„å¤„ç†é˜¶æ®µ
        update_status(task_id, 'PREPROCESSING', 'æ­£åœ¨è¯»å–è§†é¢‘å…ƒæ•°æ®...')
        video_info = preprocess_video(video_path)
        preprocessing_duration = time.time() - preprocessing_start

        # 2. åˆ†æé˜¶æ®µ
        update_status(task_id, 'ANALYZING', 'å¼€å§‹åˆ†æ...')
        analyzing_start = time.time()

        result = analyze_video(
            video_path=video_path,
            video_info=video_info,
            on_progress=lambda p: update_progress(
                task_id,
                p,
                preprocessing_duration,
                time.time() - analyzing_start,
                timeout_threshold
            )
        )

        analyzing_duration = time.time() - analyzing_start
        is_timeout = analyzing_duration > timeout_threshold

        # 3. æäº¤ç»“æœ
        requests.post(
            callback_url,
            json={
                'status': 'COMPLETED_TIMEOUT' if is_timeout else 'COMPLETED',
                'isTimeout': is_timeout,
                'preprocessingDuration': preprocessing_duration,
                'analyzingDuration': analyzing_duration,
                'totalDuration': preprocessing_duration + analyzing_duration,
                'metrics': result['metrics'],
                'events': result['events'],
                'tracks': result['tracks']
            },
            headers={'Authorization': f'Bearer {INTERNAL_TOKEN}'}
        )
    except Exception as e:
        # æäº¤å¤±è´¥ä¿¡æ¯
        requests.post(callback_url, json={
            'status': 'FAILED',
            'errorMessage': str(e)
        })

def update_status(task_id, status, message):
    """æ›´æ–°ä»»åŠ¡çŠ¶æ€"""
    requests.post(
        f'http://backend:8080/api/internal/tasks/{task_id}/progress',
        json={
            'status': status,
            'phase': status.lower(),
            'message': message
        },
        headers={'Authorization': f'Bearer {INTERNAL_TOKEN}'}
    )

def update_progress(task_id, progress_data, preprocessing_duration,
                   analyzing_elapsed, timeout_threshold):
    """æ›´æ–°åˆ†æè¿›åº¦"""
    is_timeout = analyzing_elapsed > timeout_threshold
    timeout_warning = analyzing_elapsed > timeout_threshold * 0.8

    requests.post(
        f'http://backend:8080/api/internal/tasks/{task_id}/progress',
        json={
            'status': 'ANALYZING',
            'phase': 'analyzing',
            'preprocessingDuration': preprocessing_duration,
            'analyzingElapsedTime': analyzing_elapsed,
            'isTimeout': is_timeout,
            'timeoutWarning': timeout_warning,
            **progress_data
        },
        headers={'Authorization': f'Bearer {INTERNAL_TOKEN}'}
    )
```

---

## 9. æ¥å£ç‰ˆæœ¬ç®¡ç†

### 9.1 ç‰ˆæœ¬ç­–ç•¥
- **å½“å‰ç‰ˆæœ¬**ï¼šv1.1
- **URLå‰ç¼€**ï¼š `/api/v1`
- **ç‰ˆæœ¬å‡çº§è§„åˆ™**ï¼š
  - ç ´åæ€§æ›´æ”¹ï¼šå‘å¸ƒæ–°ç‰ˆæœ¬ï¼ˆå¦‚ `/api/v2`ï¼‰
  - å…¼å®¹æ€§æ›´æ”¹ï¼šåœ¨å½“å‰ç‰ˆæœ¬è¿­ä»£

### 9.2 å¼ƒç”¨é€šçŸ¥
åœ¨å“åº”å¤´ä¸­æ·»åŠ å¼ƒç”¨è­¦å‘Šï¼š
```
Deprecation: true
Sunset: Sat, 31 Dec 2025 23:59:59 GMT
Link: <https://docs.example.com/api/v2>; rel="successor-version"
```

---

### 2.4 æŠ¥å‘Šå¯¼å‡ºï¼ˆå¿…é€‰åŠŸèƒ½ï¼‰

#### 2.4.1 å¯¼å‡ºPDFæŠ¥å‘Š
**æ¥å£**ï¼š`GET /api/tasks/{taskId}/export/pdf`

**è¯·æ±‚å‚æ•°**ï¼š
| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| includeCharts | Boolean | å¦ | æ˜¯å¦åŒ…å«å›¾è¡¨ï¼ˆé»˜è®¤trueï¼‰ |
| includeEvents | Boolean | å¦ | æ˜¯å¦åŒ…å«å¼‚å¸¸äº‹ä»¶åˆ—è¡¨ï¼ˆé»˜è®¤trueï¼‰ |
| includeTrajectory | Boolean | å¦ | æ˜¯å¦åŒ…å«è½¨è¿¹å›¾ï¼ˆé»˜è®¤falseï¼‰ |

**å“åº”**ï¼šPDFæ–‡ä»¶æµï¼ˆContent-Type: application/pdfï¼‰

**æ–‡ä»¶å**ï¼š`VARåˆ†ææŠ¥å‘Š_{ä»»åŠ¡åç§°}_{æ—¶é—´æˆ³}.pdf`

---

#### 2.4.2 å¯¼å‡ºExcelæŠ¥å‘Š
**æ¥å£**ï¼š`GET /api/tasks/{taskId}/export/excel`

**è¯·æ±‚å‚æ•°**ï¼š
| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| includeMetrics | Boolean | å¦ | æ˜¯å¦åŒ…å«åŠ¨æ€å‚æ•°æ•°æ®ï¼ˆé»˜è®¤trueï¼‰ |
| includeEvents | Boolean | å¦ | æ˜¯å¦åŒ…å«å¼‚å¸¸äº‹ä»¶æ•°æ®ï¼ˆé»˜è®¤trueï¼‰ |
| includeTracks | Boolean | å¦ | æ˜¯å¦åŒ…å«è¿½è¸ªè½¨è¿¹æ•°æ®ï¼ˆé»˜è®¤falseï¼‰ |

**å“åº”**ï¼šExcelæ–‡ä»¶æµï¼ˆContent-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheetï¼‰

**æ–‡ä»¶å**ï¼š`VARåˆ†ææ•°æ®_{ä»»åŠ¡åç§°}_{æ—¶é—´æˆ³}.xlsx`

**Excelç»“æ„**ï¼š
- **Sheet1: åŠ¨æ€å‚æ•°**
  - åˆ—ï¼šå¸§å· | æ—¶é—´(ç§’) | é—ªçƒé¢‘ç‡(Hz) | ç†”æ± é¢ç§¯(åƒç´ ) | ç†”æ± å‘¨é•¿(åƒç´ )
- **Sheet2: å¼‚å¸¸äº‹ä»¶**
  - åˆ—ï¼šäº‹ä»¶ç±»å‹ | å¼€å§‹å¸§ | ç»“æŸå¸§ | å¼€å§‹æ—¶é—´ | ç»“æŸæ—¶é—´ | è¯¦ç»†ä¿¡æ¯
- **Sheet3: è¿½è¸ªè½¨è¿¹**
  - åˆ—ï¼šç‰©ä½“ID | ç±»åˆ« | é¦–æ¬¡å‡ºç°å¸§ | æœ€åå‡ºç°å¸§ | å­˜åœ¨æ—¶é•¿(ç§’)

---

## 10. ç³»ç»Ÿé…ç½®ç®¡ç†æ¥å£

### 10.1 è·å–å…¨å±€é…ç½®
**æ¥å£**ï¼š`GET /api/config`

**å“åº”ç¤ºä¾‹**ï¼š
```json
{
  "code": 0,
  "data": {
    "timeoutRatio": "1:4",
    "confidenceThreshold": 0.5,
    "iouThreshold": 0.45,
    "modelVersion": "yolov11n",
    "maxVideoSize": 2147483648,  // æœ€å¤§è§†é¢‘å¤§å°ï¼ˆå­—èŠ‚ï¼Œ2GBï¼‰
    "supportedFormats": ["mp4", "avi", "mov"]
  }
}
```

---

### 10.2 æ›´æ–°å…¨å±€é…ç½®
**æ¥å£**ï¼š`PUT /api/config`

**è¯·æ±‚ä½“**ï¼š
```json
{
  "timeoutRatio": "2:5",
  "confidenceThreshold": 0.6,
  "iouThreshold": 0.5
}
```

**å“åº”ç¤ºä¾‹**ï¼š
```json
{
  "code": 0,
  "message": "é…ç½®å·²æ›´æ–°",
  "data": {
    "timeoutRatio": "2:5",
    "confidenceThreshold": 0.6,
    "iouThreshold": 0.5
  }
}
```

---

### 10.3 è¶…æ—¶æ¯”ä¾‹é¢„è®¾
ç³»ç»Ÿæä¾›å¸¸ç”¨çš„è¶…æ—¶æ¯”ä¾‹é¢„è®¾ï¼š

| é¢„è®¾åç§° | æ¯”ä¾‹ | è¯´æ˜ | é€‚ç”¨åœºæ™¯ |
|---------|------|------|----------|
| relaxed | 1:8 | éå¸¸å®½æ¾ | GPUæ€§èƒ½è¾ƒå·®ã€é«˜åˆ†è¾¨ç‡è§†é¢‘ |
| normal | 1:4 | æ­£å¸¸ï¼ˆé»˜è®¤ï¼‰ | ä¸€èˆ¬åœºæ™¯ |
| moderate | 2:5 | é€‚ä¸­ | GPUæ€§èƒ½è¾ƒå¥½ |
| strict | 1:2 | ä¸¥æ ¼ | é«˜æ€§èƒ½GPUã€ä½åˆ†è¾¨ç‡è§†é¢‘ |

**ä½¿ç”¨ç¤ºä¾‹**ï¼š

```json
{
  "timeoutRatio": "normal"  // æˆ–ç›´æ¥ä½¿ç”¨ "1:4"
}
```

---

### 10.4 é…ç½®éªŒè¯è§„åˆ™
- **timeoutRatio**ï¼š
  - æ ¼å¼ï¼š`{åˆ†å­}:{åˆ†æ¯}`
  - åˆ†å­èŒƒå›´ï¼š1-10
  - åˆ†æ¯èŒƒå›´ï¼š1-20
  - ç¤ºä¾‹ï¼š`1:4`, `2:5`, `3:8`

- **confidenceThreshold**ï¼š
  - ç±»å‹ï¼šFloat
  - èŒƒå›´ï¼š0.1 ~ 0.9
  - æ­¥é•¿ï¼š0.1

- **iouThreshold**ï¼š
  - ç±»å‹ï¼šFloat
  - èŒƒå›´ï¼š0.3 ~ 0.7
  - æ­¥é•¿ï¼š0.05

---

## 11. å¯é€‰æ‰©å±•æ¥å£

ä»¥ä¸‹æ¥å£ä¸ºå¯é€‰åŠŸèƒ½ï¼Œå¯åœ¨åç»­ç‰ˆæœ¬ä¸­å®ç°ï¼š

### 11.1 ç”¨æˆ·ç®¡ç†ä¸è®¤è¯ï¼ˆå¯é€‰ï¼‰

#### 11.1.1 ç”¨æˆ·æ³¨å†Œ
**æ¥å£**ï¼š`POST /api/auth/register`

**è¯·æ±‚ä½“**ï¼š
```json
{
  "username": "user123",
  "password": "password123",
  "email": "user@example.com"
}
```

---

#### 11.1.2 ç”¨æˆ·ç™»å½•
**æ¥å£**ï¼š`POST /api/auth/login`

**è¯·æ±‚ä½“**ï¼š
```json
{
  "username": "user123",
  "password": "password123"
}
```

**å“åº”ç¤ºä¾‹**ï¼š
```json
{
  "code": 0,
  "data": {
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "expiresIn": 86400,  // 24å°æ—¶
    "user": {
      "id": "user-id-xxx",
      "username": "user123",
      "email": "user@example.com"
    }
  }
}
```

**è¯´æ˜**ï¼šå¯ç”¨JWTè®¤è¯åï¼Œæ‰€æœ‰APIè¯·æ±‚éœ€åœ¨è¯·æ±‚å¤´æ·»åŠ ï¼š
```
Authorization: Bearer {token}
```

---

### 11.2 å®æ—¶è§†é¢‘æµåˆ†æï¼ˆå¯é€‰ï¼‰

#### 11.2.1 åˆ›å»ºæµåˆ†æä»»åŠ¡
**æ¥å£**ï¼š`POST /api/stream/tasks`

**è¯·æ±‚ä½“**ï¼š
```json
{
  "streamUrl": "rtsp://example.com/live/stream1",
  "protocol": "RTSP",  // RTSP/RTMP
  "duration": 600,  // åˆ†ææ—¶é•¿ï¼ˆç§’ï¼‰ï¼Œ0è¡¨ç¤ºæŒç»­åˆ†æ
  "config": {
    "confidenceThreshold": 0.5,
    "iouThreshold": 0.45
  }
}
```

**å“åº”ç¤ºä¾‹**ï¼š
```json
{
  "code": 0,
  "data": {
    "taskId": "stream-task-xxx",
    "status": "STREAMING",
    "startedAt": "2025-10-01T10:30:00Z"
  }
}
```

---

#### 11.2.2 è·å–æµåˆ†æå®æ—¶ç»“æœ
**æ¥å£**ï¼š`GET /api/stream/tasks/{taskId}/events`

**è¯·æ±‚å‚æ•°**ï¼š
| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| since | Long | å¦ | è·å–æŒ‡å®šæ—¶é—´æˆ³ä¹‹åçš„äº‹ä»¶ï¼ˆæ¯«ç§’ï¼‰ |
| limit | Integer | å¦ | æœ€å¤šè¿”å›æ•°é‡ï¼ˆé»˜è®¤100ï¼‰ |

---

### 11.3 æ¨¡å‹ç‰ˆæœ¬ç®¡ç†ï¼ˆå¯é€‰ï¼‰

#### 11.3.1 è·å–å¯ç”¨æ¨¡å‹åˆ—è¡¨
**æ¥å£**ï¼š`GET /api/models`

**å“åº”ç¤ºä¾‹**ï¼š
```json
{
  "code": 0,
  "data": {
    "models": [
      {
        "id": "yolov11n",
        "name": "YOLOv11 Nano",
        "version": "1.0.0",
        "size": "6.2MB",
        "performance": "fast",
        "accuracy": "medium",
        "isDefault": true
      },
      {
        "id": "yolov11s",
        "name": "YOLOv11 Small",
        "version": "1.0.0",
        "size": "20MB",
        "performance": "medium",
        "accuracy": "high",
        "isDefault": false
      }
    ]
  }
}
```

---

#### 11.3.2 åˆ‡æ¢é»˜è®¤æ¨¡å‹
**æ¥å£**ï¼š`PUT /api/models/{modelId}/set-default`

---

### 11.4 æ€§èƒ½ç›‘æ§æ¥å£ï¼ˆå¯é€‰ï¼‰

#### 11.4.1 è·å–ç³»ç»Ÿæ€§èƒ½æŒ‡æ ‡
**æ¥å£**ï¼š`GET /api/metrics/system`

**å“åº”ç¤ºä¾‹**ï¼š
```json
{
  "code": 0,
  "data": {
    "timestamp": 1696147200000,
    "backend": {
      "cpuUsage": 45.2,
      "memoryUsage": 68.5,
      "activeConnections": 12
    },
    "aiProcessor": {
      "gpuUsage": 85.3,
      "gpuMemoryUsage": 72.1,
      "queueSize": 3,
      "avgProcessingTime": 2450  // ç§’
    },
    "rabbitmq": {
      "queueDepth": 5,
      "messagesPerSecond": 0.5
    }
  }
}
```

---

#### 11.4.2 è·å–ä»»åŠ¡å¤„ç†ç»Ÿè®¡
**æ¥å£**ï¼š`GET /api/metrics/tasks`

**è¯·æ±‚å‚æ•°**ï¼š
| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| startDate | String | å¦ | èµ·å§‹æ—¥æœŸï¼ˆISO 8601æ ¼å¼ï¼‰ |
| endDate | String | å¦ | ç»“æŸæ—¥æœŸï¼ˆISO 8601æ ¼å¼ï¼‰ |

**å“åº”ç¤ºä¾‹**ï¼š
```json
{
  "code": 0,
  "data": {
    "totalTasks": 156,
    "completedTasks": 142,
    "timeoutTasks": 8,
    "failedTasks": 6,
    "avgProcessingTime": 2680,  // ç§’
    "avgPreprocessingTime": 12,
    "avgAnalyzingTime": 2668
  }
}
```

---

## 12. æ¥å£æµ‹è¯•

### 12.1 æµ‹è¯•å·¥å…·
- **Postman**ï¼šæ‰‹åŠ¨æµ‹è¯•
- **JUnit + MockMvc**ï¼šåç«¯å•å…ƒæµ‹è¯•
- **pytest + requests**ï¼šAIæ¨¡å—é›†æˆæµ‹è¯•

### 12.2 æµ‹è¯•ç”¨ä¾‹ï¼ˆPostman Collectionï¼‰

```json
{
  "info": {
    "name": "VARç†”æ± åˆ†æç³»ç»ŸAPIæµ‹è¯•",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "item": [
    {
      "name": "ä¸Šä¼ è§†é¢‘",
      "request": {
        "method": "POST",
        "url": "{{base_url}}/api/tasks/upload",
        "body": {
          "mode": "formdata",
          "formdata": [
            {
              "key": "video",
              "type": "file",
              "src": "test_video.mp4"
            }
          ]
        }
      }
    }
  ]
}
```

---

## 13. å®‰å…¨æ€§è¯´æ˜

### 13.1 å¿…é€‰å®‰å…¨æªæ–½

#### 13.1.1 è§†é¢‘ä¸Šä¼ å®‰å…¨
- **æ–‡ä»¶å¤§å°é™åˆ¶**ï¼šæœ€å¤§2GB
- **æ ¼å¼æ ¡éªŒ**ï¼š
  - MIMEç±»å‹æ£€æŸ¥ï¼š`video/mp4`, `video/x-msvideo`, `video/quicktime`
  - é­”æ•°éªŒè¯ï¼šæ£€æŸ¥æ–‡ä»¶å¤´å­—èŠ‚ç¡®è®¤çœŸå®æ ¼å¼
  - æ‰©å±•åç™½åå•ï¼š`.mp4`, `.avi`, `.mov`
- **æ¶æ„æ–‡ä»¶é˜²æŠ¤**ï¼š
  - ä¸Šä¼ åé‡å‘½åæ–‡ä»¶ï¼ˆUUIDï¼‰
  - ç¦æ­¢æ‰§è¡Œæƒé™
  - ç‹¬ç«‹å­˜å‚¨ç›®å½•ï¼Œä¸åº”ç”¨ä»£ç éš”ç¦»

#### 13.1.2 æ•æ„Ÿä¿¡æ¯ä¿æŠ¤
- **ç¯å¢ƒå˜é‡é…ç½®**ï¼š
  ```bash
  # æ•°æ®åº“é…ç½®
  DB_HOST=localhost
  DB_PORT=5432
  DB_NAME=var_analysis
  DB_USERNAME=postgres
  DB_PASSWORD=your_password_here
  
  # Redisé…ç½®
  REDIS_HOST=localhost
  REDIS_PORT=6379
  REDIS_PASSWORD=your_redis_password
  
  # RabbitMQé…ç½®
  RABBITMQ_HOST=localhost
  RABBITMQ_PORT=5672
  RABBITMQ_USERNAME=guest
  RABBITMQ_PASSWORD=your_rabbitmq_password
  
  # å†…éƒ¨æœåŠ¡è®¤è¯Token
  INTERNAL_TOKEN=your_internal_token_here
  ```

- **é…ç½®åŠ è½½**ï¼š
  - åç«¯ï¼šSpring Bootä½¿ç”¨`@Value`æ³¨è§£æˆ–`application.yml`çš„`${}`å ä½ç¬¦
  - AIæ¨¡å—ï¼šPythonä½¿ç”¨`os.getenv()`æˆ–`python-dotenv`

#### 13.1.3 è¯·æ±‚å®‰å…¨
- **CORSé…ç½®**ï¼šé™åˆ¶å…è®¸çš„åŸŸå
- **è¯·æ±‚é¢‘ç‡é™åˆ¶**ï¼šé˜²æ­¢æš´åŠ›ä¸Šä¼ ï¼ˆå¦‚æ¯IPæ¯å°æ—¶æœ€å¤š10ä¸ªä»»åŠ¡ï¼‰
- **æ–‡ä»¶è·¯å¾„éå†é˜²æŠ¤**ï¼šä¸¥æ ¼æ ¡éªŒæ–‡ä»¶è·¯å¾„å‚æ•°

---

### 13.2 å¯é€‰å®‰å…¨æªæ–½

#### 13.2.1 JWT Tokenè®¤è¯ï¼ˆå¯é€‰ï¼‰
å¯ç”¨åï¼Œæ‰€æœ‰APIè¯·æ±‚éœ€æºå¸¦JWT Tokenï¼š

**è¯·æ±‚å¤´**ï¼š

```
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

**Tokenè¿‡æœŸå¤„ç†**ï¼š

- è¿‡æœŸæ—¶é—´ï¼š24å°æ—¶ï¼ˆå¯é…ç½®ï¼‰
- åˆ·æ–°æœºåˆ¶ï¼šæä¾›`/api/auth/refresh`æ¥å£
- è¿‡æœŸå“åº”ï¼šè¿”å›401 Unauthorized

#### 13.2.2 HTTPSå¼ºåˆ¶ï¼ˆç”Ÿäº§ç¯å¢ƒæ¨èï¼‰
- Nginxé…ç½®å¼ºåˆ¶HTTPSé‡å®šå‘
- è¯ä¹¦ï¼šLet's Encryptå…è´¹è¯ä¹¦æˆ–å•†ä¸šè¯ä¹¦

---

## 14. æ¥å£ä¼˜å…ˆçº§è§„åˆ’

åŸºäºç³»ç»Ÿè®¾è®¡æ–‡æ¡£çš„å¿…é€‰/å¯é€‰æ ‡è®°ï¼Œæ¥å£å®ç°ä¼˜å…ˆçº§å¦‚ä¸‹ï¼š

### P0ï¼ˆå¿…é¡»å®ç°ï¼‰
- âœ… ä»»åŠ¡ç®¡ç†æ¥å£ï¼ˆä¸Šä¼ ã€æŸ¥è¯¢ã€åˆ é™¤ï¼‰
- âœ… åˆ†æç»“æœæŸ¥è¯¢æ¥å£ï¼ˆåŠ¨æ€å‚æ•°ã€å¼‚å¸¸äº‹ä»¶ã€è¿½è¸ªè½¨è¿¹ï¼‰
- âœ… è§†é¢‘è®¿é—®æ¥å£
- âœ… æŠ¥å‘Šå¯¼å‡ºæ¥å£ï¼ˆPDF/Excelï¼‰
- âœ… ç³»ç»Ÿé…ç½®ç®¡ç†æ¥å£
- âœ… å†…éƒ¨å›è°ƒæ¥å£ï¼ˆè¿›åº¦ã€ç»“æœï¼‰
- âœ… è§†é¢‘ä¸Šä¼ å®‰å…¨é™åˆ¶
- âœ… æ•æ„Ÿä¿¡æ¯ç¯å¢ƒå˜é‡é…ç½®

### P1ï¼ˆåç»­ä¼˜åŒ–ï¼‰
- ğŸ”² WebSocketå®æ—¶æ¨é€
- ğŸ”² å¸¦æ ‡æ³¨çš„è§†é¢‘å¯¼å‡º
- ğŸ”² æ€§èƒ½ç›‘æ§æ¥å£
- ğŸ”² ä»»åŠ¡å¤„ç†ç»Ÿè®¡

### P2ï¼ˆæ‰©å±•åŠŸèƒ½ï¼‰
- ğŸ”² ç”¨æˆ·ç®¡ç†ä¸JWTè®¤è¯
- ğŸ”² å®æ—¶è§†é¢‘æµåˆ†æ
- ğŸ”² æ¨¡å‹ç‰ˆæœ¬ç®¡ç†
- ğŸ”² HTTPSå¼ºåˆ¶

---

**æ–‡æ¡£ç‰ˆæœ¬**ï¼šv1.1
**æ›´æ–°æ—¥æœŸ**ï¼š2025-10-01
**ç»´æŠ¤è€…**ï¼šä¾¯é˜³æ´‹
**å˜æ›´è¯´æ˜**ï¼š

- v1.1: æ–°å¢æŠ¥å‘Šå¯¼å‡ºæ¥å£ã€å®‰å…¨æ€§è¯´æ˜ã€æ¥å£ä¼˜å…ˆçº§è§„åˆ’
- v1.0: åˆå§‹ç‰ˆæœ¬